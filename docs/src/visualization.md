# Visualization Guide

## Overview

BayesInteractomics provides visualization functions at three levels:

1. **Pipeline plots**: Automatically generated by `run_analysis` (volcano, convergence, evidence)
2. **Per-protein plots**: Detailed inference diagnostics for individual proteins
3. **Diagnostic plots**: Model validation visualizations (PPC, residuals, calibration)

## Pipeline Plots

These are generated automatically by `run_analysis` and saved to the paths specified in [`OutputFiles`](@ref).

### Volcano Plot

Shows posterior probability vs. mean log₂ fold-change for all proteins:

```julia
plot_analysis(copula_df, "volcano.png")
```

Highlights high-confidence interactors with strong enrichment.

### Evidence Plot

Distribution of individual and combined Bayes factors:

```julia
evidence_plot(copula_df)
```

Three-panel plot showing enrichment, correlation, and detection BFs.

### Rank-Rank Plot

Compares rankings between individual models and the combined result:

```julia
rank_rank_plot(copula_df)
```

Helps identify proteins where individual models disagree.

### Convergence Plot

EM algorithm convergence diagnostics (generated from `EMResult`):

- Log-likelihood trajectory
- Mixing proportion (π₁) trajectory
- Copula parameter evolution

## Per-Protein Plots

These can be generated during `analyse()` by setting the corresponding flags to `true`, or called manually for specific proteins.

### Posterior Distribution Plot

```julia
plot_inference_results(hbm_result, file = "posterior.png")
plot_inference_results(bayes_result, file = "posterior.png")
```

Shows posterior vs. prior distributions for sample and control means.

### Log₂ Fold-Change Plot

```julia
plot_log2fc(bayes_result, real_log2fc, file = "log2fc.png")
```

Multiple dispatch methods for:
- `BayesResult`: Extracts HBM result automatically
- `HBMResult`: Direct HBM posterior visualization
- Raw posterior/prior distributions

### Regression Plot

```julia
plot_regression(bayes_result, x, y, file = "regression.png")
```

Draws posterior predictive regression lines over observed data. Available for:
- Single-protocol experiments (`RegressionResultSingleProtocol`)
- Multi-protocol experiments (`RegressionResultMultipleProtocols`): 3-panel layout with global, per-protocol, and residual panels

### Bayes Factor Range Plot

```julia
plot_bayesrange(bayes_result, protocol_positions, protein_name,
    file = "bayesrange.png")
```

Shows how the Bayes factor changes as a function of the log₂FC threshold, separately for each protocol and the global estimate. Useful for understanding the sensitivity of the enrichment evidence.

## Diagnostic Plots

See the [Diagnostics and Model Validation](@ref) page for details. Summary:

| Function | Purpose |
|---|---|
| `ppc_density_plot` | Observed vs. predicted density |
| `ppc_pvalue_histogram` | PPC p-value distribution |
| `residual_qq_plot` | Q-Q plot of standardized residuals |
| `scale_location_plot` | Detect heteroscedasticity |
| `residual_distribution_plot` | Residual shape |
| `calibration_plot` | Predicted vs. empirical probabilities |
| `calibration_comparison_plot` | Compare calibration criteria |
| `pit_histogram_plot` | Probability Integral Transform |
| `nu_optimization_plot` | WAIC vs. Student-t ν |
| `bb_ppc_summary_plot` | Beta-Bernoulli PPC summary |
| `sensitivity_tornado_plot` | Prior impact ranking |
| `sensitivity_heatmap` | Posterior across prior settings |
| `sensitivity_rank_correlation` | Ranking stability |

## Differential Analysis Plots

See the [Differential Interaction Analysis](@ref) page for details. Summary:

| Function | Purpose |
|---|---|
| `differential_volcano_plot` | Differential BF vs. significance |
| `differential_evidence_plot` | Per-evidence differential BFs |
| `differential_scatter_plot` | Condition A vs. B comparison |
| `differential_classification_plot` | Classification summary bar chart |
| `differential_ma_plot` | MA plot for bias detection |

## Network Plots

See the [Network Analysis](@ref) page for details:

```julia
plot_network(net, layout = :spring, node_size = :degree, show_labels = true)
save_network_plot(net, "network.png")
```

## Customization Tips

### Saving Plots

All plot functions return StatsPlots plot objects. Save with:

```julia
using StatsPlots
plt = volcano_plot(df)
savefig(plt, "plot.png")   # PNG
savefig(plt, "plot.svg")   # SVG
savefig(plt, "plot.pdf")   # PDF
```

### Image Format

Control the default format in `OutputFiles`:

```julia
output = OutputFiles("/results", image_ext = ".svg")
```

### Plot Size and Resolution

```julia
plt = volcano_plot(df)
plot!(plt, size = (1200, 800), dpi = 300)
savefig(plt, "publication_figure.png")
```

## API Reference

### Pipeline Plots

```@docs
plot_analysis
plot_results
evidence_plot
rank_rank_plot
volcano_plot
```

### Per-Protein Plots

```@docs
plot_inference_results
plot_log2fc
plot_regression
plot_bayesrange
```
